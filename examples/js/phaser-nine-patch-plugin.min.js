/************ Nine patch plugin by Vitaliy Zheltyakov **************/
(function(w,t){t.NinePatchImage=function(k,p,q,g,h,l,r){p=p||0;q=q||0;g=g||0;h=h||0;l=l||null;r=r||null;if(0==g||0==h||null===l)return k.add.image(p,q,PIXI.TextureCache.__missing);var f=k.make.bitmapData();f.smoothed=!1;f.load(l);var m=f.width,n=f.height;if(g<m||h<n)return k.add.image(p,q,PIXI.TextureCache.__missing);for(var d={},a={},b=[],e=2;e<m-1;e++)parseInt(f.getPixelRGB(e,0).a/245)!=parseInt(f.getPixelRGB(e-1,0).a/245)&&"undefined"===typeof d.x1?d.x1=e:parseInt(f.getPixelRGB(e,0).a/245)!=parseInt(f.getPixelRGB(e-
1,0).a/245)&&"undefined"!==typeof d.x1&&(d.x2=e),parseInt(f.getPixelRGB(e,n-1).a/245)!=parseInt(f.getPixelRGB(e-1,n-1).a/245)&&"undefined"===typeof a.x1?a.x1=e:parseInt(f.getPixelRGB(e,n-1).a/245)!=parseInt(f.getPixelRGB(e-1,n-1).a/245)&&"undefined"!==typeof a.x1&&(a.x2=e);b[0]={};b[0].x=1;b[0].xNew=0;b[0].width=d.x1-1;b[0].widthNew=b[0].width;b[0].type=parseInt(f.getPixelRGB(1,0).a/245)?"stretch":"const";b[1]={};b[1].x=d.x1;b[1].xNew=d.x1-1;b[1].width=d.x2-d.x1-1;b[1].widthNew=b[1].width;b[1].type=
parseInt(f.getPixelRGB(d.x1,0).a/245)?"stretch":"const";b[2]={};b[2].x=d.x2;b[2].xNew=d.x2-1;b[2].width=m-d.x2-1;b[2].widthNew=b[2].width;b[2].type=parseInt(f.getPixelRGB(d.x2,0).a/245)?"stretch":"const";for(var c=[],e=2;e<n-1;e++)parseInt(f.getPixelRGB(0,e).a/245)!=parseInt(f.getPixelRGB(0,e-1).a/245)&&"undefined"===typeof d.y1?d.y1=e:parseInt(f.getPixelRGB(0,e).a/245)!=parseInt(f.getPixelRGB(0,e-1).a/245)&&"undefined"!==typeof d.y1&&(d.y2=e),parseInt(f.getPixelRGB(m-1,e).a/245)!=parseInt(f.getPixelRGB(m-
1,e-1).a/245)&&"undefined"===typeof a.y1?a.y1=e:parseInt(f.getPixelRGB(m-1,e).a/245)!=parseInt(f.getPixelRGB(m-1,e-1).a/245)&&"undefined"!==typeof a.y1&&(a.y2=e);c[0]={};c[0].y=1;c[0].yNew=0;c[0].height=d.y1-1;c[0].heightNew=c[0].height;c[0].type=parseInt(f.getPixelRGB(0,1).a/245)?"stretch":"const";c[1]={};c[1].y=d.y1;c[1].yNew=d.y1-1;c[1].height=d.y2-d.y1-1;c[1].heightNew=c[1].height;c[1].type=parseInt(f.getPixelRGB(0,d.y1).a/245)?"stretch":"const";c[2]={};c[2].y=d.y2;c[2].yNew=d.y2-1;c[2].height=
n-d.y2-1;c[2].heightNew=c[2].height;c[2].type=parseInt(f.getPixelRGB(0,d.y2).a/245)?"stretch":"const";if("const"==b[0].type&&"stretch"==b[1].type&&"const"==b[2].type)b[1].widthNew=g-b[0].widthNew-b[2].widthNew+1,b[2].xNew=g-b[2].widthNew;else if("stretch"==b[0].type&&"const"==b[1].type&&"stretch"==b[2].type)b[0].widthNew=Math.round((g-b[1].width)/2),b[2].widthNew=g-b[1].width-b[0].widthNew,b[1].xNew=Math.round((g-b[1].width)/2),b[2].xNew=b[1].xNew+b[1].widthNew;else return k.add.image(p,q,PIXI.TextureCache.__missing);
if("const"==c[0].type&&"stretch"==c[1].type&&"const"==c[2].type)c[1].heightNew=h-c[0].heightNew-c[2].heightNew+1,c[2].yNew=h-c[2].heightNew;else if("stretch"==c[0].type&&"const"==c[1].type&&"stretch"==c[2].type)c[0].heightNew=Math.round((h-c[1].height)/2),c[2].heightNew=h-c[1].height-c[0].heightNew,c[1].yNew=Math.round((h-c[1].height)/2),c[2].yNew=c[1].yNew+c[1].heightNew;else return k.add.image(p,q,PIXI.TextureCache.__missing);var u=k.add.bitmapData(g,h);u.smoothed=!1;for(e=0;3>e;e++)for(var v=0;3>
v;v++)u.copy(f,b[e].x,c[v].y,b[e].width,c[v].height,b[e].xNew,c[v].yNew,b[e].widthNew,c[v].heightNew);null===r&&(r=l+"-"+g+"-"+h);l=PIXI.CanvasPool.create(this,u.width,u.height);l.getContext("2d",{alpha:!0}).putImageData(u.ctx.getImageData(0,0,u.width,u.height),0,0);l=PIXI.Texture.fromCanvas(l);PIXI.Texture.addTextureToCache(l,r);t.Image.call(this,k,p,q,l);f.destroy();u.destroy();this.paddingBox={x:0,y:0,width:g,height:h};"undefined"!==typeof a.x1&&"undefined"!==typeof a.x2&&"undefined"!==typeof a.y1&&
"undefined"!==typeof a.y2&&(a.x1<d.x1&&"const"==b[0].type?a.x1=a.x1:a.x1<d.x1&&"stretch"==b[0].type?a.x1=a.x1/b[1].x*b[0].widthNew:a.x1<d.x2&&"const"==b[1].type?a.x1=b[0].widthNew+b[1].widthNew-(b[2].x-a.x1):a.x1<d.x2&&"stretch"==b[1].type?a.x1=(a.x1-b[0].x)/b[1].width*b[1].widthNew:a.x1>d.x2&&"const"==b[2].type?a.x1=g-(m-a.x1):a.x1>d.x2&&"stretch"==b[2].type&&(a.x1=g-(m-a.x1)/b[2].width*b[2].widthNew),a.x2<d.x1&&"const"==b[0].type?a.x2=a.x2:a.x2<d.x1&&"stretch"==b[0].type?a.x2=a.x2/b[1].x*b[0].widthNew:
a.x2<d.x2&&"const"==b[1].type?a.x2=b[0].widthNew+b[1].widthNew-(b[2].x-a.x2):a.x2<d.x2&&"stretch"==b[1].type?a.x2=(a.x2-b[0].x)/b[1].width*b[1].widthNew:a.x2>d.x2&&"const"==b[2].type?a.x2=g-(m-a.x2):a.x2>d.x2&&"stretch"==b[2].type&&(a.x2=g-(m-a.x2)/b[2].width*b[2].widthNew),a.y1<d.y1&&"const"==c[0].type?a.y1=a.y1:a.y1<d.y1&&"stretch"==c[0].type?a.y1=a.y1/c[1].y*c[0].heightNew:a.y1<d.y2&&"const"==c[1].type?a.y1=c[0].heightNew+c[1].heightNew-(c[2].y-a.y1):a.y1<d.y2&&"stretch"==c[1].type?a.y1=(a.y1-
c[0].y)/c[1].height*c[1].heightNew:a.y1>d.y2&&"const"==c[2].type?a.y1=h-(n-a.y1):a.y1>d.y2&&"stretch"==c[2].type&&(a.y1=h-(n-a.y1)/c[2].height*c[2].heightNew),a.y2<d.y1&&"const"==c[0].type?a.y2=a.y2:a.y2<d.y1&&"stretch"==c[0].type?a.y2=a.y2/c[1].y*c[0].heightNew:a.y2<d.y2&&"const"==c[1].type?a.y2=c[0].heightNew+c[1].heightNew-(c[2].y-a.y2):a.y2<d.y2&&"stretch"==c[1].type?a.y2=(a.y2-c[0].y)/c[1].height*c[1].heightNew:a.y2>d.y2&&"const"==c[2].type?a.y2=h-(n-a.y2):a.y2>d.y2&&"stretch"==c[2].type&&(a.y2=
h-(n-a.y2)/c[2].height*c[2].heightNew),this.paddingBoxOriginal={x:a.x1,y:a.y1,width:a.x2-a.x1,height:a.y2-a.y1});return this};t.NinePatchImage.prototype=Object.create(t.Image.prototype);t.NinePatchImage.prototype.constructor=t.NinePatchImage;t.GameObjectFactory.prototype.ninePatchImage=function(k,p,q,g,h,l,r){void 0===r&&(r=this.world);return r.add(new t.NinePatchImage(this.game,k,p,q,g,h,l))};Object.defineProperty(PIXI.DisplayObjectContainer.prototype,"paddingBox",{get:function(){return{x:this.scale.x*
this.paddingBoxOriginal.x,y:this.scale.y*this.paddingBoxOriginal.y,width:this.scale.x*this.paddingBoxOriginal.width,height:this.scale.y*this.paddingBoxOriginal.height}},set:function(k){"undefined"!==typeof paddingBoxOriginal&&(this.paddingBoxOriginal.x=k.x/this.scale.x,this.paddingBoxOriginal.y=k.x/this.scale.y,this.paddingBoxOriginal.width=k.x/this.scale.width,this.paddingBoxOriginal.height=k.x/this.scale.height)}})})(window,Phaser);